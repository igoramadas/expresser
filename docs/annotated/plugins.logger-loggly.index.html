<!DOCTYPE html>

<html>
<head>
  <title>index.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>index.coffee</h1>
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="lib.app.html">
                    app.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="lib.errors.html">
                    errors.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="lib.events.html">
                    events.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="lib.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="lib.logger.html">
                    logger.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="lib.settings.html">
                    settings.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="lib.utils.html">
                    utils.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.aws.dynamodb.html">
                    dynamodb.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.aws.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.aws.s3.html">
                    s3.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.aws.sns.html">
                    sns.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.cron.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.cron.job.html">
                    job.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.gcloud.datastore.html">
                    datastore.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.gcloud.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.gcloud.storage.html">
                    storage.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.logger-file.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.logger-logentries.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.logger-loggly.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.mailer.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.mailer.templates.html">
                    templates.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.metrics.httpserver.html">
                    httpserver.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.metrics.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.metrics.percentile.html">
                    percentile.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.mongodb.index.html">
                    index.coffee
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="plugins.sockets.index.html">
                    index.coffee
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        <h2 id="expresser-logger-loggly">EXPRESSER LOGGER - LOGGLY</h2>

        
      
        
        
        
          <div class='highlight'><pre>fs = <span class="hljs-built_in">require</span> <span class="hljs-string">"fs"</span>
loggly = <span class="hljs-built_in">require</span> <span class="hljs-string">"./loggly/index.js"</span>
path = <span class="hljs-built_in">require</span> <span class="hljs-string">"path"</span>

lodash = <span class="hljs-literal">null</span>
logger = <span class="hljs-literal">null</span>
logglyClient = <span class="hljs-literal">null</span>
settings = <span class="hljs-literal">null</span></pre></div>
        
      
        
        <p>##
Loggly plugin for Expresser.</p>
<p>##</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoggerLoggly</span></span>
    priority: <span class="hljs-number">1</span></pre></div>
        
      
        
        <h2 id="init">INIT</h2>

        
      
        
        
        
      
        
        <p>##
Init the Loggly logging module. If default settings are defined on “settings.logger.loggly”,
it will auto register itself to the main Logger as “loggly”. Please note that this init
should be called automatically by the main Expresser <code>init()</code>.
@private</p>
<p>##</p>

        
          <div class='highlight'><pre>    init: <span class="hljs-function">-&gt;</span>
        events = @expresser.events
        lodash = @expresser.libs.lodash
        logger = @expresser.logger
        settings = @expresser.settings

        logger.drivers.loggly = <span class="hljs-keyword">this</span>

        logger.debug <span class="hljs-string">"LoggerLoggly.init"</span></pre></div>
        
      
        
        <p>Auto register as “loggly” if a default token is defined on the settings.</p>

        
          <div class='highlight'><pre>        <span class="hljs-keyword">if</span> settings.logger.loggly.enabled <span class="hljs-keyword">and</span> settings.logger.loggly.token?
            logger.register <span class="hljs-string">"loggly"</span>, <span class="hljs-string">"loggly"</span>, settings.logger.loggly

        events.emit <span class="hljs-string">"LoggerLoggly.on.init"</span>
        <span class="hljs-keyword">delete</span> @init</pre></div>
        
      
        
        <p>##
Get the Loggly transport object.
@param {Object} options Loggly options.
@param {String} [options.token] Loggly access token, mandatory.
@param {String} [options.subdomain] Subdomain registered on Loggly, mandatory.
@param {Boolean} [options.json] Treat log parameters as JSON? Should be false unless you have very specific reasons.
@param {Boolean} [options.sendTimestamp] Send timestamp along log lines? Default is defined on settings.
@param {Function} [options.onLogSuccess] Function to execute on successful log calls, optional.
@param {Function} [options.onLogError] Function to execute on failed log calls, optional.
@return {Object} The Loggly logger transport.</p>
<p>##</p>

        
          <div class='highlight'><pre>    getTransport: <span class="hljs-function"><span class="hljs-params">(options)</span> -&gt;</span>
        logger.debug <span class="hljs-string">"LoggerLoggly.getTransport"</span>, options

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> settings.logger.loggly.enabled
            <span class="hljs-keyword">return</span> logger.notEnabled <span class="hljs-string">"LoggerFile"</span>

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options?.token? <span class="hljs-keyword">or</span> options.token <span class="hljs-keyword">is</span> <span class="hljs-string">""</span>
            <span class="hljs-keyword">return</span> errors.<span class="hljs-keyword">throw</span> tokenRequired, <span class="hljs-string">"Please set a valid options.token."</span>

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options?.subdomain? <span class="hljs-keyword">or</span> options.subdomain <span class="hljs-keyword">is</span> <span class="hljs-string">""</span>
            <span class="hljs-keyword">return</span> errors.<span class="hljs-keyword">throw</span> domainRequired, <span class="hljs-string">"Please set a valid options.subdomain."</span>

        options = lodash.defaultsDeep options, settings.logger.loggly
        options.sendTimestamp = settings.logger.sendTimestamp <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.sendTimestamp
        options.json = <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.json?
        options.onLogSuccess = logger.onLogSuccess <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.onLogSuccess?
        options.onLogError = logger.onLogError <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.onLogError?

        transport = {client: loggly.createClient {token: options.token, subdomain: options.subdomain}}
        transport.onLogSuccess = options.onLogSuccess
        transport.onLogError = options.onLogError

        <span class="hljs-keyword">return</span> transport</pre></div>
        
      
        
        <h2 id="log-methods">LOG METHODS</h2>

        
      
        
        
        
      
        
        <p>##
Loggly log method.
@param {String} logType The log type (info, warn, error, debug, etc).
@param {Array} args Array or string to be logged.
@param {Boolean} avoidConsole If true it will NOT log to the console.</p>
<p>##</p>

        
          <div class='highlight'><pre>    log: <span class="hljs-function"><span class="hljs-params">(logType, args, avoidConsole)</span> -&gt;</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> settings.logger.levels.indexOf(logType) &lt; <span class="hljs-number">0</span></pre></div>
        
      
        
        <p>Get message out of the arguments if not a string.</p>

        
          <div class='highlight'><pre>        <span class="hljs-keyword">if</span> lodash.isString args
            message = args
        <span class="hljs-keyword">else</span>
            message = logger.getMessage args

        @client.log message, <span class="hljs-function"><span class="hljs-params">(err, result)</span> =&gt;</span>
            <span class="hljs-keyword">if</span> err?
                @onLogError? err
            <span class="hljs-keyword">else</span>
                @onLogSuccess? result</pre></div>
        
      
        
        <p>Log to the console depending on <code>console</code> setting.</p>

        
          <div class='highlight'><pre>        <span class="hljs-keyword">if</span> settings.logger.<span class="hljs-built_in">console</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> avoidConsole
            logger.<span class="hljs-built_in">console</span> logType, args</pre></div>
        
      
        
        <h2 id="singleton-implementation">Singleton implementation</h2>

        
      
        
        
        
          <div class='highlight'><pre>LoggerLoggly.getInstance = <span class="hljs-function">-&gt;</span>
    @instance = <span class="hljs-keyword">new</span> LoggerLoggly() <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @instance?
    <span class="hljs-keyword">return</span> @instance

<span class="hljs-built_in">module</span>.exports = exports = LoggerLoggly.getInstance()</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
