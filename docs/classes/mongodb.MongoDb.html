<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Expresser - mongodb.MongoDb</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-9331973-3"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-9331973-3');
</script><script>if (location.protocol.match(/^http/) && location.pathname.match('\.html') === null && location.pathname.slice(-1) !== '/') {
  location.href = location.href + '/';
}</script><link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script><script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--><link href="../google-code-prettify/prettify.css" rel="stylesheet" type="text/css"><link href="../style.css" rel="stylesheet" type="text/css"></head><body data-spy="scroll" data-target=".sidebar"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#top-navigation-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="collapse navbar-collapse" id="top-navigation-collapse"><ul class="nav navbar-nav"><li><a href="../index.html">Home</a></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Guides <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../guides/App.html">App</a></li><li><a href="../guides/Errors.html">Errors</a></li><li><a href="../guides/Events.html">Events</a></li><li><a href="../guides/Logger.html">Logger</a></li><li><a href="../guides/Settings.html">Settings</a></li><li><a href="../guides/Utils.html">Utils</a></li></ul></li><li class="active"><a href="../classes/index.html">Classes - mongodb.MongoDb</a></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Files <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../files/app.coffee.html">app.coffee</a></li><li><a href="../files/errors.coffee.html">errors.coffee</a></li><li><a href="../files/events.coffee.html">events.coffee</a></li><li><a href="../files/index.coffee.html">index.coffee</a></li><li><a href="../files/logger.coffee.html">logger.coffee</a></li><li><a href="../files/settings.coffee.html">settings.coffee</a></li><li><a href="../files/utils.coffee.html">utils.coffee</a></li><li><a href="../files/aws.dynamodb.coffee.html">aws/dynamodb.coffee</a></li><li><a href="../files/aws.index.coffee.html">aws/index.coffee</a></li><li><a href="../files/aws.s3.coffee.html">aws/s3.coffee</a></li><li><a href="../files/aws.sns.coffee.html">aws/sns.coffee</a></li><li><a href="../files/cron.index.coffee.html">cron/index.coffee</a></li><li><a href="../files/cron.job.coffee.html">cron/job.coffee</a></li><li><a href="../files/gcloud.datastore.coffee.html">gcloud/datastore.coffee</a></li><li><a href="../files/gcloud.index.coffee.html">gcloud/index.coffee</a></li><li><a href="../files/gcloud.storage.coffee.html">gcloud/storage.coffee</a></li><li><a href="../files/logger-file.index.coffee.html">logger-file/index.coffee</a></li><li><a href="../files/logger-logentries.index.coffee.html">logger-logentries/index.coffee</a></li><li><a href="../files/logger-loggly.index.coffee.html">logger-loggly/index.coffee</a></li><li><a href="../files/mailer.index.coffee.html">mailer/index.coffee</a></li><li><a href="../files/mailer.templates.coffee.html">mailer/templates.coffee</a></li><li><a href="../files/metrics.httpserver.coffee.html">metrics/httpserver.coffee</a></li><li><a href="../files/metrics.index.coffee.html">metrics/index.coffee</a></li><li><a href="../files/metrics.percentile.coffee.html">metrics/percentile.coffee</a></li><li><a href="../files/mongodb.index.coffee.html">mongodb/index.coffee</a></li><li><a href="../files/sockets.index.coffee.html">sockets/index.coffee</a></li><li><a href="../files/swagger.index.coffee.html">swagger/index.coffee</a></li><li><a href="../files/utils.browser.coffee.html">utils/browser.coffee</a></li><li><a href="../files/utils.data.coffee.html">utils/data.coffee</a></li><li><a href="../files/utils.io.coffee.html">utils/io.coffee</a></li><li><a href="../files/utils.network.coffee.html">utils/network.coffee</a></li><li><a href="../files/utils.system.coffee.html">utils/system.coffee</a></li></ul></li></ul><div class="options"><label class="checkbox"><input id="options-private" type="checkbox"> Private</label></div></div></div></nav><div class="container-fluid content"><div class="row"><div class="hidden-xs sidebar col-sm-3" data-spy="affix"><div class="cormo-sidenav"><div class="panel panel-default"><div class="panel-collapse collapse in" id="undefined_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/App.html">App</a></li><li><a href="../classes/Errors.html">Errors</a></li><li><a href="../classes/Events.html">Events</a></li><li><a href="../classes/Expresser.html">Expresser</a></li><li><a href="../classes/Logger.html">Logger</a></li><li><a href="../classes/Settings.html">Settings</a></li><li><a href="../classes/Utils.html">Utils</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#aws_body">aws<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="aws_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/aws.AWS.html">AWS</a></li><li><a href="../classes/aws.DynamoDB.html">DynamoDB</a></li><li><a href="../classes/aws.S3.html">S3</a></li><li><a href="../classes/aws.SNS.html">SNS</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#cron_body">cron<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="cron_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/cron.Cron.html">Cron</a></li><li><a href="../classes/cron.CronJob.html">CronJob</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#gcloud_body">gcloud<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="gcloud_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/gcloud.GCloud.html">GCloud</a></li><li><a href="../classes/gcloud.GCloudDatastore.html">GCloudDatastore</a></li><li><a href="../classes/gcloud.GCloudStorage.html">GCloudStorage</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#logger-file_body">logger-file<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="logger-file_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/logger-file.LoggerFile.html">LoggerFile</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#logger-logentries_body">logger-logentries<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="logger-logentries_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/logger-logentries.LoggerLogentries.html">LoggerLogentries</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#logger-loggly_body">logger-loggly<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="logger-loggly_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/logger-loggly.LoggerLoggly.html">LoggerLoggly</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#mailer_body">mailer<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="mailer_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/mailer.EmailTemplates.html">EmailTemplates</a></li><li><a href="../classes/mailer.Mailer.html">Mailer</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#metrics_body">metrics<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="metrics_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/metrics.HttpServer.html">HttpServer</a></li><li><a href="../classes/metrics.Metrics.html">Metrics</a></li><li><a href="../classes/metrics.Percentile.html">Percentile</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#mongodb_body">mongodb<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="mongodb_body"><ul class="nav nav-pills nav-stacked"><li class="active"><a href="#mongodb_MongoDb">MongoDb</a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__connect">connect</a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__count">count</a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__get">get</a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__init">init</a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__insert">insert</a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__remove">remove</a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__update">update</a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__client">client<span class="pull-right label label-property">property</span></a></li><li class="cormo-class-property"><a href="#mongodb_MongoDb__connections">connections<span class="pull-right label label-property">property</span></a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#sockets_body">sockets<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="sockets_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/sockets.Sockets.html">Sockets</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#swagger_body">swagger<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="swagger_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/swagger.Swagger.html">Swagger</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#utils_body">utils<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="utils_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/utils.BrowserUtils.html">BrowserUtils</a></li><li><a href="../classes/utils.DataUtils.html">DataUtils</a></li><li><a href="../classes/utils.IOUtils.html">IOUtils</a></li><li><a href="../classes/utils.NetworkUtils.html">NetworkUtils</a></li><li><a href="../classes/utils.SystemUtils.html">SystemUtils</a></li></ul></div></div></div></div><div class="col-sm-9 col-sm-offset-3"><span class="fix-anchor" id="mongodb_MongoDb"></span><section><h1 class="class_title">MongoDb</h1><div><p>Handles MongoDB database transactions using the native <code>mongodb</code> module.</p>
</div><div></div><div class="showcode"><button class="btn btn-info">Show class code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L10">/plugins/mongodb/index.coffee:10</a>)</span></div><pre class="sourcecode prettyprint .linenums:10">class MongoDb
    priority: 2</pre><div class="panel panel-info"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb_ctor_body"><h3 class="panel-title">Constructor<span class="pull-right glyphicon"></span></h3></div><div class="panel-collapse collapse" id="mongodb_MongoDb_ctor_body"><div class="panel-body"><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__connect"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__connect_body"><h3 class="panel-title">MongoDb::connect(connString, options)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Get the DB connection object.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__connect_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>connString</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The connection string, for example user:password@hostname/dbname.</span></td></tr><tr><td><span class="method-depth0"></span><code>options</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Additional options to be passed when creating the DB connection object.</span></td></tr></table><h4>Returns<small><span> as</span><span class="label label-info">Promise</span></small></h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>(Returns)</td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span>The database connection object.</span></td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L50">/plugins/mongodb/index.coffee:50</a>)</span></div><pre class="sourcecode prettyprint .linenums:50">connect: (connString, options) =&gt;
    logger.debug &quot;MongoDb.connect&quot;, connString

    # Tries to connect to the specified database.
    return new Promise (resolve, reject) =&gt;
        if not settings.mongodb.enabled
            notEnabled = logger.notEnabled &quot;MongoDb&quot;
            return reject notEnabled

        connStringSafe = connString
        sep = connString.indexOf &quot;@&quot;
        connStringSafe = connStringSafe.substring sep if sep &gt; 0
        sep = connString.indexOf &quot;/&quot;
        connStringSafe = connStringSafe.substring 0, sep if sep &gt; 0

        result = {connString: connString, connection: null}

        # Connection string is mandatory!
        if not connString? or connString is &quot;&quot;
            return reject {error: &quot;Connection string not set.&quot;}

        @client.connect connString, options, (err, conn) =&gt;
            if err?
                logger.error &quot;MongoDb.getConnection&quot;, &quot;Could not connect to #{connStringSafe}.&quot;, err

                reject err
            else
                logger.info &quot;MongoDb.getConnection&quot;, &quot;Connected to #{connStringSafe}&quot;
                result.connection = conn
                result.get = @get
                result.insert = @insert
                result.update = @update
                result.remove = @remove
                result.count = @count

                resolve result</pre></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__count"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__count_body"><h3 class="panel-title">MongoDb::count(collection, filter, callback)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Count documents from the database. A <code>collection</code> must be specified.
If no <code>filter</code> is not passed then count all documents.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__count_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>collection</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String'>String</a></span></td><td><span> The collection name.</span></td></tr><tr><td><span class="method-depth0"></span><code>filter</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Optional, keys-values filter of documents to be counted.</span></td></tr><tr><td><span class="method-depth0"></span><code>callback</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function'>Function</a>()</span></td><td><span> Callback (err, result) when operation has finished.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L305">/plugins/mongodb/index.coffee:305</a>)</span></div><pre class="sourcecode prettyprint .linenums:305">count: (collection, filter, callback) -&gt;
    if not callback? and lodash.isFunction filter
        callback = filter
        filter = {}

    if not @connection?
        throw new Error &quot;MongoDb.count: the db was not initialized, please check database settings and call its 'init' method.&quot;

    # Callback is mandatory!
    if not callback?
        throw new Error &quot;MongoDb.count: a callback (last argument) must be specified.&quot;

    # Create the DB callback helper.
    dbCallback = (err, result) =&gt;
        if callback?
            logger.debug &quot;MongoDb.count&quot;, collection, filter, &quot;Result #{result}&quot;
            callback err, result

    # MongoDB has a built-in count so use it.
    dbCollection = @connection.collection collection
    dbCollection.count filter, dbCallback</pre></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__get"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__get_body"><h3 class="panel-title">MongoDb::get(collection, filter, options, callback)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Get data from the database. A <code>collection</code> and <code>callback</code> must be specified. The <code>filter</code> is optional.
Please note that if <code>filter</code> has an _id or id field, or if it&#39;s a plain string or number, it will be used
to return documents by ID. Otherwise it&#39;s used as keys-values object for filtering.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__get_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>collection</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String'>String</a></span></td><td><span> The collection name.</span></td></tr><tr><td><span class="method-depth0"></span><code>filter</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Optional, if a string or number, assume it's the document ID. Otherwise assume keys-values filter.</span></td></tr><tr><td><span class="method-depth0"></span><code>options</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Options to be passed to the query.</span></td></tr><tr><td><span class="method-depth1"></span><code>limit</code><span class="pull-right label label-optional">optional</span></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Number'>Number</a></span></td><td><span> Limits the resultset to X documents.</span></td></tr><tr><td><span class="method-depth0"></span><code>callback</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function'>Function</a>()</span></td><td><span> Callback (err, result) when operation has finished.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L100">/plugins/mongodb/index.coffee:100</a>)</span></div><pre class="sourcecode prettyprint .linenums:100">get: (collection, filter, options, callback) -&gt;
    if not callback?
        if lodash.isFunction options
            callback = options
            options = null
        else if lodash.isFunction filter
            callback = filter
            filter = null

    if not @connection?
        throw new Error &quot;MongoDb.get: the db was not initialized, please check database settings and call its 'init' method.&quot;

    # Callback is mandatory!
    if not callback?
        throw new Error &quot;MongoDb.get: a callback (last argument) must be specified.&quot;

    # Create the DB callback helper.
    dbCallback = (err, result) =&gt;
        if callback?
            callback err, result

    # Set collection object.
    dbCollection = @connection.collection collection

    # Parse ID depending on `filter`.
    if filter?
        if filter._id?
            id = filter._id
        else
            t = typeof filter
            id = filter if t is &quot;string&quot; or t is &quot;integer&quot;

    # Get `limit` option.
    if options?.limit?
        limit = options.limit
    else
        limit = 0

    # Find documents depending on `filter` and `options`.
    # If id is set, use the shorter findById.
    if id?
        dbCollection.findById id, dbCallback

    # Create a params object for the find method.
    else if filter?
        findParams = {$query: filter}
        findParams[&quot;$orderby&quot;] = options.orderBy if options?.orderBy?

        if limit &gt; 0
            dbCollection.find(findParams).limit(limit).toArray dbCallback
        else
            dbCollection.find(findParams).toArray dbCallback

    # Search everything!
    else
        if limit &gt; 0
            dbCollection.find({}).limit(limit).toArray dbCallback
        else
            dbCollection.find({}).toArray dbCallback

    if filter?
        filterLog = filter
        logger.debug &quot;MongoDb.get&quot;, collection, filterLog, options
    else
        logger.debug &quot;MongoDb.get&quot;, collection, &quot;No filter.&quot;, options</pre></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__init"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__init_body"><h3 class="panel-title">MongoDb::init()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Init the MongoDB database module.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__init_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>(Returns)</td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span>Returns the MongoDB connection created (only if default settings are set).</span></td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L31">/plugins/mongodb/index.coffee:31</a>)</span></div><pre class="sourcecode prettyprint .linenums:31">init: =&gt;
    database = @expresser.database
    events = @expresser.events
    lodash = @expresser.libs.lodash
    logger = @expresser.logger
    settings = @expresser.settings

    logger.debug &quot;MongoDb.init&quot;

    events.emit &quot;MongoDb.on.init&quot;
    delete @init</pre></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__insert"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__insert_body"><h3 class="panel-title">MongoDb::insert(collection, obj, callback)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Add new documents to the database.
The <code>options</code> parameter is optional.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__insert_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>collection</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String'>String</a></span></td><td><span> The collection name.</span></td></tr><tr><td><span class="method-depth0"></span><code>obj</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Document or array of documents to be added.</span></td></tr><tr><td><span class="method-depth0"></span><code>callback</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function'>Function</a>()</span></td><td><span> Callback (err, result) when operation has finished.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L173">/plugins/mongodb/index.coffee:173</a>)</span></div><pre class="sourcecode prettyprint .linenums:173">insert: (collection, obj, callback) -&gt;
    if not @connection?
        throw new Error &quot;MongoDb.insert: the db was not initialized, please check database settings and call its 'init' method.&quot;

    if not obj?
        throw new Error &quot;MongoDb.insert: no object (second argument) was specified.&quot;

    # Create the DB callback helper.
    dbCallback = (err, result) =&gt;
        if callback?
            callback err, result

    # Set collection object.
    dbCollection = @connection.collection collection

    # Execute insert!
    dbCollection.insert obj, dbCallback
    logger.debug &quot;MongoDb.insert&quot;, collection</pre></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__remove"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__remove_body"><h3 class="panel-title">MongoDb::remove(collection, filter, callback)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Delete an object from the database. The <code>obj</code> argument can be either the document itself, or its integer/string ID.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__remove_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>collection</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String'>String</a></span></td><td><span> The collection name.</span></td></tr><tr><td><span class="method-depth0"></span><code>filter</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> If a string or number, assume it's the document ID. Otherwise assume the document itself.</span></td></tr><tr><td><span class="method-depth0"></span><code>callback</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function'>Function</a>()</span></td><td><span> Callback (err, result) when operation has finished.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L263">/plugins/mongodb/index.coffee:263</a>)</span></div><pre class="sourcecode prettyprint .linenums:263">remove: (collection, filter, callback) -&gt;
    if not callback? and lodash.isFunction options
        callback = options
        options = {}

    if not @connection?
        throw new Error &quot;MongoDb.remove: the db was not initialized, please check database settings and call its 'init' method.&quot;

    # Filter is mandatory.
    if not filter?
        throw new Error &quot;MongoDb.remove: no filter (second argument) was specified.&quot;

    # Check it the `obj` is the model itself, or only the ID string / number.
    if filter._id?
        id = filter._id
    else
        t = typeof filter
        id = filter if t is &quot;string&quot; or t is &quot;integer&quot;

    # Create the DB callback helper.
    dbCallback = (err, result) =&gt;
        if callback?
            callback err, result

    # Set collection object and remove specified object from the database.
    dbCollection = @connection.collection collection

    # Remove object by ID or filter.
    if id? and id isnt &quot;&quot;
        dbCollection.removeById id, dbCallback
    else
        dbCollection.remove filter, dbCallback

    logger.debug &quot;MongoDb.remove&quot;, collection, filter</pre></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__update"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__update_body"><h3 class="panel-title">MongoDb::update(collection, obj, options, callback)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Update existing documents on the database.
The <code>options</code> parameter is optional.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__update_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>collection</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String'>String</a></span></td><td><span> The collection name.</span></td></tr><tr><td><span class="method-depth0"></span><code>obj</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Document or data to be updated.</span></td></tr><tr><td><span class="method-depth0"></span><code>options</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Optional, options to control and filter the insert behaviour.</span></td></tr><tr><td><span class="method-depth1"></span><code>filter</code><span class="pull-right label label-optional">optional</span></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Defines the query filter. If not specified, will try using the ID of the passed object.</span></td></tr><tr><td><span class="method-depth1"></span><code>patch</code><span class="pull-right label label-optional">optional</span></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Boolean'>Boolean</a></span></td><td><span> Default is false, if true replace only the specific properties of documents instead of the whole data, using $set.</span></td></tr><tr><td><span class="method-depth1"></span><code>upsert</code><span class="pull-right label label-optional">optional</span></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Boolean'>Boolean</a></span></td><td><span> Default is false, if true it will create documents if none was found.</span></td></tr><tr><td><span class="method-depth0"></span><code>callback</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function'>Function</a>()</span></td><td><span> Callback (err, result) when operation has finished.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L203">/plugins/mongodb/index.coffee:203</a>)</span></div><pre class="sourcecode prettyprint .linenums:203">update: (collection, obj, options, callback) -&gt;
    if not callback? and lodash.isFunction options
        callback = options
        options = {}

    if not @connection?
        throw new Error &quot;MongoDb.update: the db was not initialized, please check database settings and call its 'init' method.&quot;

    # Object or filter is mandatory.
    if not obj?
        throw new Error &quot;MongoDb.update: no object (second argument) was specified.&quot;

    # Create the DB callback helper.
    dbCallback = (err, result) =&gt;
        if callback?
            callback err, result

    # Set collection object.
    dbCollection = @connection.collection collection

    # Make sure the ID is converted to ObjectID.
    if obj._id?
        id = mongoskin.ObjectID.createFromHexString obj._id.toString()

    # Make sure options is valid.
    options = {} if not options?

    # If a `filter` option was set, use it as the query filter otherwise use the &quot;_id&quot; property.
    if options.filter?
        filter = options.filter
    else
        filter = {_id: id}

    delete options.filter

    # If options patch is set, replace specified document properties only instead of replacing the whole document.
    if options.patch
        docData = {$set: obj}
    else
        docData = obj

    delete options.patch

    # Set default options.
    options = lodash.defaults options, {upsert: false, multi: true}

    # Execute update!
    dbCollection.update filter, docData, options, dbCallback

    if id?
        logger.debug &quot;MongoDb.update&quot;, collection, options, &quot;ID: #{id}&quot;
    else
        logger.debug &quot;MongoDb.update&quot;, collection, options, &quot;New document.&quot;</pre></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__client"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__client_body"><h3 class="panel-title">MongoDb::client<span class="label label-property">property</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>The MongoDB official client.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__client_body"><div class="panel-body"><div></div><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L16">/plugins/mongodb/index.coffee:16</a>)</span></div><pre class="sourcecode prettyprint .linenums:16">client: require(&quot;mongodb&quot;).MongoClient</pre></div></div></div></section><span class="fix-anchor" id="mongodb_MongoDb__connections"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#mongodb_MongoDb__connections_body"><h3 class="panel-title">MongoDb::connections : <a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array'>Array</a><span class="label label-property">property</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Collection holding all connected databases.</p>
</div></div><div class="panel-collapse collapse" id="mongodb_MongoDb__connections_body"><div class="panel-body"><div></div><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//plugins/mongodb/index.coffee#L22">/plugins/mongodb/index.coffee:22</a>)</span></div><pre class="sourcecode prettyprint .linenums:22">connections: []</pre></div></div></div></section></div></div></div><script src="https://code.jquery.com/jquery-3.2.1.min.js"></script><script src="../bootstrap/js/bootstrap.min.js"></script><script src="../google-code-prettify/prettify.js"></script><script src="../script.js"></script><script src="../group-examples.js"></script><a href="https://github.com/igoramadas/expresser"><img class="github-ribbon" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a></body></html>