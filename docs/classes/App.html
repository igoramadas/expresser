<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Expresser - App</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-9331973-3"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-9331973-3');
</script><script>if (location.protocol.match(/^http/) && location.pathname.match('\.html') === null && location.pathname.slice(-1) !== '/') {
  location.href = location.href + '/';
}</script><link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script><script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--><link href="../google-code-prettify/prettify.css" rel="stylesheet" type="text/css"><link href="../style.css" rel="stylesheet" type="text/css"></head><body data-spy="scroll" data-target=".sidebar"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#top-navigation-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="collapse navbar-collapse" id="top-navigation-collapse"><ul class="nav navbar-nav"><li><a href="../index.html">Home</a></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Guides <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../guides/App.html">App</a></li><li><a href="../guides/Errors.html">Errors</a></li><li><a href="../guides/Events.html">Events</a></li><li><a href="../guides/Logger.html">Logger</a></li><li><a href="../guides/Settings.html">Settings</a></li><li><a href="../guides/Utils.html">Utils</a></li></ul></li><li class="active"><a href="../classes/index.html">Classes - App</a></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Files <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../files/app.coffee.html">app.coffee</a></li><li><a href="../files/errors.coffee.html">errors.coffee</a></li><li><a href="../files/events.coffee.html">events.coffee</a></li><li><a href="../files/index.coffee.html">index.coffee</a></li><li><a href="../files/logger.coffee.html">logger.coffee</a></li><li><a href="../files/settings.coffee.html">settings.coffee</a></li><li><a href="../files/utils.coffee.html">utils.coffee</a></li><li><a href="../files/aws.dynamodb.coffee.html">aws/dynamodb.coffee</a></li><li><a href="../files/aws.index.coffee.html">aws/index.coffee</a></li><li><a href="../files/aws.s3.coffee.html">aws/s3.coffee</a></li><li><a href="../files/aws.sns.coffee.html">aws/sns.coffee</a></li><li><a href="../files/cron.index.coffee.html">cron/index.coffee</a></li><li><a href="../files/downloader.index.coffee.html">downloader/index.coffee</a></li><li><a href="../files/gcloud.datastore.coffee.html">gcloud/datastore.coffee</a></li><li><a href="../files/gcloud.index.coffee.html">gcloud/index.coffee</a></li><li><a href="../files/gcloud.storage.coffee.html">gcloud/storage.coffee</a></li><li><a href="../files/logger-file.index.coffee.html">logger-file/index.coffee</a></li><li><a href="../files/logger-logentries.index.coffee.html">logger-logentries/index.coffee</a></li><li><a href="../files/logger-loggly.index.coffee.html">logger-loggly/index.coffee</a></li><li><a href="../files/mailer.index.coffee.html">mailer/index.coffee</a></li><li><a href="../files/mailer.templates.coffee.html">mailer/templates.coffee</a></li><li><a href="../files/metrics.httpserver.coffee.html">metrics/httpserver.coffee</a></li><li><a href="../files/metrics.index.coffee.html">metrics/index.coffee</a></li><li><a href="../files/metrics.percentile.coffee.html">metrics/percentile.coffee</a></li><li><a href="../files/mongodb.index.coffee.html">mongodb/index.coffee</a></li><li><a href="../files/sockets.index.coffee.html">sockets/index.coffee</a></li><li><a href="../files/utils.browser.coffee.html">utils/browser.coffee</a></li><li><a href="../files/utils.data.coffee.html">utils/data.coffee</a></li><li><a href="../files/utils.io.coffee.html">utils/io.coffee</a></li><li><a href="../files/utils.network.coffee.html">utils/network.coffee</a></li><li><a href="../files/utils.system.coffee.html">utils/system.coffee</a></li></ul></li></ul><div class="options"><label class="checkbox"><input id="options-private" type="checkbox"> Private</label></div></div></div></nav><div class="container-fluid content"><div class="row"><div class="hidden-xs sidebar col-sm-3" data-spy="affix"><div class="cormo-sidenav"><div class="panel panel-default"><div class="panel-collapse collapse in" id="undefined_body"><ul class="nav nav-pills nav-stacked"><li class="active"><a href="#App">App</a></li><li class="cormo-class-property"><a href="#App__all">all</a></li><li class="cormo-class-property private"><a href="#App__configure">configure<span class="pull-right label label-private">private</span></a></li><li class="cormo-class-property"><a href="#App__delete">delete</a></li><li class="cormo-class-property"><a href="#App__get">get</a></li><li class="cormo-class-property"><a href="#App__init">init</a></li><li class="cormo-class-property"><a href="#App__kill">kill</a></li><li class="cormo-class-property"><a href="#App__listRoutes">listRoutes</a></li><li class="cormo-class-property"><a href="#App__listen">listen</a></li><li class="cormo-class-property"><a href="#App__patch">patch</a></li><li class="cormo-class-property"><a href="#App__post">post</a></li><li class="cormo-class-property"><a href="#App__put">put</a></li><li class="cormo-class-property"><a href="#App__renderError">renderError</a></li><li class="cormo-class-property"><a href="#App__renderImage">renderImage</a></li><li class="cormo-class-property"><a href="#App__renderJson">renderJson</a></li><li class="cormo-class-property"><a href="#App__renderView">renderView</a></li><li class="cormo-class-property"><a href="#App__route">route</a></li><li class="cormo-class-property"><a href="#App__start">start</a></li><li class="cormo-class-property"><a href="#App__use">use</a></li><li class="cormo-class-property"><a href="#App__appendMiddlewares">appendMiddlewares<span class="pull-right label label-property">property</span></a></li><li class="cormo-class-property"><a href="#App__expressApp">expressApp<span class="pull-right label label-property">property</span></a></li><li class="cormo-class-property"><a href="#App__prependMiddlewares">prependMiddlewares<span class="pull-right label label-property">property</span></a></li><li class="cormo-class-property"><a href="#App__redirectorServer">redirectorServer<span class="pull-right label label-property">property</span></a></li><li class="cormo-class-property"><a href="#App__webServer">webServer<span class="pull-right label label-property">property</span></a></li><li><a href="../classes/Errors.html">Errors</a></li><li><a href="../classes/Events.html">Events</a></li><li><a href="../classes/Logger.html">Logger</a></li><li><a href="../classes/Settings.html">Settings</a></li><li><a href="../classes/Utils.html">Utils</a></li></ul></div></div><div class="panel panel-default"><div class="panel-heading" data-toggle="collapse" data-target="#utils_body">utils<span class="pull-right glyphicon"></span></div><div class="panel-collapse collapse in" id="utils_body"><ul class="nav nav-pills nav-stacked"><li><a href="../classes/utils.BrowserUtils.html">BrowserUtils</a></li><li><a href="../classes/utils.DataUtils.html">DataUtils</a></li><li><a href="../classes/utils.IoUtils.html">IoUtils</a></li><li><a href="../classes/utils.NetworkUtils.html">NetworkUtils</a></li><li><a href="../classes/utils.SystemUtils.html">SystemUtils</a></li></ul></div></div></div></div><div class="col-sm-9 col-sm-offset-3"><span class="fix-anchor" id="App"></span><section><h1 class="class_title">App</h1><div><p>This is the &quot;core&quot; of an Expresser based application. The App wraps the
Express server and its middlewares / routes, along with a few extra helpers.</p>
</div><div></div><div class="showcode"><button class="btn btn-info">Show class code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L22">/lib/app.coffee:22</a>)</span></div><pre class="sourcecode prettyprint .linenums:22">class App
    newInstance: -&gt; return new App()</pre><div class="panel panel-info"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App_ctor_body"><h3 class="panel-title">Constructor<span class="pull-right glyphicon"></span></h3></div><div class="panel-collapse collapse" id="App_ctor_body"><div class="panel-body"><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table></div></div></div></section><span class="fix-anchor" id="App__all"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__all_body"><h3 class="panel-title">App::all()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .all().</p>
</div></div><div class="panel-collapse collapse" id="App__all_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L243">/lib/app.coffee:243</a>)</span></div><pre class="sourcecode prettyprint .linenums:243">all: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.all.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__configure"></span><section class="private"><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__configure_body"><h3 class="panel-title">App::configure()<span class="label label-private">private</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Configure the server. Set views, options, use Express modules, etc.
Called automatically on <code>init()</code>, so normally you should never need
to call <code>configure()</code> on your own.</p>
</div></div><div class="panel-collapse collapse" id="App__configure_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L93">/lib/app.coffee:93</a>)</span></div><pre class="sourcecode prettyprint .linenums:93">configure: -&gt;
    midBodyParser = require &quot;body-parser&quot;
    midCookieParser = require &quot;cookie-parser&quot;
    midSession = require &quot;cookie-session&quot;
    midCompression = require &quot;compression&quot;

    if settings.general.debug or nodeEnv is &quot;test&quot;
        midErrorHandler = require &quot;errorhandler&quot;

    # Create express v4 app.
    @expressApp = express()

    # DEPRECATED! The &quot;server&quot; was renamed to &quot;expressApp&quot;.
    @server = @expressApp

    # Set view options, use Pug for HTML templates.
    @expressApp.set &quot;views&quot;, settings.app.viewPath
    @expressApp.set &quot;view engine&quot;, settings.app.viewEngine
    @expressApp.set &quot;view options&quot;, { layout: false }

    # Prepend middlewares, if any was specified.
    if @prependMiddlewares.length &gt; 0
        @expressApp.use mw for mw in @prependMiddlewares

    # Use Express basic handlers.
    @expressApp.use midBodyParser.json {limit: settings.app.bodyParser.limit}
    @expressApp.use midBodyParser.urlencoded {extended: settings.app.bodyParser.extended, limit: settings.app.bodyParser.limit}

    if settings.app.cookie.enabled
        @expressApp.use midCookieParser settings.app.cookie.secret

    if settings.app.session.enabled
        @expressApp.use midSession {secret: settings.app.session.secret, cookie: {maxAge: new Date(Date.now() + (settings.app.session.maxAge * 1000))}}

    # Use HTTP compression only if enabled on settings.
    if settings.app.compressionEnabled
        @expressApp.use midCompression

    # Fix connect assets helper context.
    connectAssetsOptions = lodash.cloneDeep settings.app.connectAssets
    connectAssetsOptions.helperContext = @expressApp.locals

    # Connect assets and dynamic compiling.
    ConnectAssets = (require &quot;./app/connect-assets.js&quot;) connectAssetsOptions
    @expressApp.use ConnectAssets

    # Append extra middlewares, if any was specified.
    if @appendMiddlewares.length &gt; 0
        @expressApp.use mw for mw in @appendMiddlewares

    # Configure development environment to dump exceptions and show stack.
    if settings.general.debug or nodeEnv is &quot;test&quot;
        @expressApp.use midErrorHandler {dumpExceptions: true, showStack: true}

    # Use Express static routing.
    @expressApp.use express.static settings.app.publicPath

    # Log all requests if debug is true.
    if settings.general.debug
        @expressApp.use (req, res, next) -&gt;
            ip = utils.browser.getClientIP req
            method = req.method
            url = req.url

            console.log &quot;Request from #{ip}&quot;, method, url

            next() if next?

            return url

    # We should not call configure more than once!
    delete @configure</pre></div></div></div></section><span class="fix-anchor" id="App__delete"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__delete_body"><h3 class="panel-title">App::delete()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .delete().</p>
</div></div><div class="panel-collapse collapse" id="App__delete_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L273">/lib/app.coffee:273</a>)</span></div><pre class="sourcecode prettyprint .linenums:273">delete: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.delete.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__get"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__get_body"><h3 class="panel-title">App::get()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .get().</p>
</div></div><div class="panel-collapse collapse" id="App__get_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L249">/lib/app.coffee:249</a>)</span></div><pre class="sourcecode prettyprint .linenums:249">get: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.get.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__init"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__init_body"><h3 class="panel-title">App::init()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Create, configure and run the Express application. In most cases this should be
the last step of you app loading, after loading custom modules, setting custom
configuration, etc. Please note that this will be called automatically if
you call the main <code>expresser.init()</code>.</p>
</div></div><div class="panel-collapse collapse" id="App__init_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L66">/lib/app.coffee:66</a>)</span></div><pre class="sourcecode prettyprint .linenums:66">init: -&gt;
    logger.debug &quot;App.init&quot;
    events.emit &quot;App.before.init&quot;

    nodeEnv = process.env.NODE_ENV

    # Get version from main app's package.json (NOT Expresser, but the actual app using it!)
    try
        @version = require(@expresser.rootPath + &quot;/package.json&quot;)?.version
    catch ex
        logger.error &quot;App.init&quot;, &quot;Could not fetch version from package.json.&quot;, ex

    # Configure the Express server.
    @configure()

    # Start web server!
    @start()

    events.emit &quot;App.on.init&quot;
    delete @init</pre></div></div></div></section><span class="fix-anchor" id="App__kill"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__kill_body"><h3 class="panel-title">App::kill()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Kill the underlying HTTP(S) server(s).</p>
</div></div><div class="panel-collapse collapse" id="App__kill_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L227">/lib/app.coffee:227</a>)</span></div><pre class="sourcecode prettyprint .linenums:227">kill: -&gt;
    events.emit &quot;App.before.kill&quot;

    @redirectorServer?.close()
    @redirectorServer = null

    @webServer?.close()
    webServer = null

    events.emit &quot;App.on.kill&quot;</pre></div></div></div></section><span class="fix-anchor" id="App__listRoutes"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__listRoutes_body"><h3 class="panel-title">App::listRoutes(asString)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Return an array with all routes registered on the Express application.</p>
</div></div><div class="panel-collapse collapse" id="App__listRoutes_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>asString</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Boolean'>Boolean</a></span></td><td><span> If true, returns the route strings only, otherwise returns full objects.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td>(Returns)</td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array'>Array</a></span></td><td><span>Array with the routes (as object or as string if asString = true).</span></td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L303">/lib/app.coffee:303</a>)</span></div><pre class="sourcecode prettyprint .linenums:303">listRoutes: (asString = false) =&gt;
    result = []

    for r in @expressApp._router.stack
        if r.route?.path? and r.route.path isnt &quot;&quot;
            if asString
                result.push r.route.path
            else
                result.push {route: r.route.path, methods: lodash.keys(r.route.methods)}

    return result</pre></div></div></div></section><span class="fix-anchor" id="App__listen"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__listen_body"><h3 class="panel-title">App::listen()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .listen().</p>
</div></div><div class="panel-collapse collapse" id="App__listen_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L279">/lib/app.coffee:279</a>)</span></div><pre class="sourcecode prettyprint .linenums:279">listen: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.listen.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__patch"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__patch_body"><h3 class="panel-title">App::patch()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .patch().</p>
</div></div><div class="panel-collapse collapse" id="App__patch_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L267">/lib/app.coffee:267</a>)</span></div><pre class="sourcecode prettyprint .linenums:267">patch: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.patch.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__post"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__post_body"><h3 class="panel-title">App::post()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .post().</p>
</div></div><div class="panel-collapse collapse" id="App__post_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L255">/lib/app.coffee:255</a>)</span></div><pre class="sourcecode prettyprint .linenums:255">post: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.post.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__put"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__put_body"><h3 class="panel-title">App::put()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .put().</p>
</div></div><div class="panel-collapse collapse" id="App__put_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L261">/lib/app.coffee:261</a>)</span></div><pre class="sourcecode prettyprint .linenums:261">put: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.put.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__renderError"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__renderError_body"><h3 class="panel-title">App::renderError(req, res, error, status)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Sends error response as JSON.</p>
</div></div><div class="panel-collapse collapse" id="App__renderError_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>req</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The Express request object, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>res</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The Express response object, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>error</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The error object or message to be sent to the client, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>status</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Number'>Number</a></span></td><td><span> The response status code, optional, default is 500.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L410">/lib/app.coffee:410</a>)</span></div><pre class="sourcecode prettyprint .linenums:410">renderError: (req, res, error, status) -&gt;
    logger.error &quot;App.renderError&quot;, req.originalUrl, status, error

    # Status defaults to 500.
    status = error?.statusCode or 500 if not status?
    status = 408 if status is &quot;ETIMEDOUT&quot;

    try
        if lodash.isError error
            error = error.message + &quot; &quot; + error.stack
        else if not lodash.isString error
            error = JSON.stringify error, null, 0
    catch ex
        error = error.toString()

    # Send error JSON to client.
    res.status(status).json {error: error, url: req.originalUrl}

    events.emit &quot;App.on.renderError&quot;, req, res, error, status</pre></div></div></div></section><span class="fix-anchor" id="App__renderImage"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__renderImage_body"><h3 class="panel-title">App::renderImage(req, res, filename, options)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Render an image from the speficied file, and send to the client.</p>
</div></div><div class="panel-collapse collapse" id="App__renderImage_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>req</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The Express request object, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>res</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The Express response object, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>filename</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String'>String</a></span></td><td><span> The full path to the image file, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>options</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Options passed to the image renderer, for example the "mimetype".</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L386">/lib/app.coffee:386</a>)</span></div><pre class="sourcecode prettyprint .linenums:386">renderImage: (req, res, filename, options) -&gt;
    logger.debug &quot;App.renderImage&quot;, req.originalUrl, filename, options

    mimetype = options?.mimetype

    # Try to figure out the mime type in case it wasn't passed along the options.
    if not mimetype?
        extname = path.extname(filename).toLowerCase().replace(&quot;.&quot;,&quot;&quot;)
        extname = &quot;jpeg&quot; if extname is &quot;jpg&quot;
        mimetype = &quot;image/#{extname}&quot;

    # Send image to client.
    res.contentType mimetype
    res.sendFile filename

    events.emit &quot;App.on.renderImage&quot;, req, res, filename, options</pre></div></div></div></section><span class="fix-anchor" id="App__renderJson"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__renderJson_body"><h3 class="panel-title">App::renderJson(req, res, data)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Render response as JSON data and send to the client.</p>
</div></div><div class="panel-collapse collapse" id="App__renderJson_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>req</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The Express request object, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>res</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The Express response object, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>data</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The JSON data to be sent, mandatory.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L348">/lib/app.coffee:348</a>)</span></div><pre class="sourcecode prettyprint .linenums:348">renderJson: (req, res, data) -&gt;
    logger.debug &quot;App.renderJson&quot;, req.originalUrl, data

    if lodash.isString data
        try
            data = JSON.parse data
        catch ex
            return @renderError req, res, ex, 500

    # Remove methods from JSON before rendering.
    cleanJson = (obj) -&gt;
        if lodash.isArray obj
            cleanJson i for i in obj
        else if lodash.isObject obj
            for k, v of obj
                if lodash.isFunction v
                    delete obj[k]
                else
                    cleanJson v

    cleanJson data

    # Add Access-Control-Allow-Origin to all when debug is true.
    if settings.general.debug
        res.setHeader &quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;

    # Send JSON response.
    res.json data

    events.emit &quot;App.on.renderJson&quot;, req, res, data</pre></div></div></div></section><span class="fix-anchor" id="App__renderView"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__renderView_body"><h3 class="panel-title">App::renderView(req, res, view, options)<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Render a Pug view and send to the client.</p>
</div></div><div class="panel-collapse collapse" id="App__renderView_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><th>Name</th><th>Type</th><th>Description</th></tr><tr><td><span class="method-depth0"></span><code>req</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The Express request object, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>res</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> The Express response object, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>view</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String'>String</a></span></td><td><span> The Pug view filename, mandatory.</span></td></tr><tr><td><span class="method-depth0"></span><code>options</code></td><td><span><a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object'>Object</a></span></td><td><span> Options passed to the view, optional.</span></td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L322">/lib/app.coffee:322</a>)</span></div><pre class="sourcecode prettyprint .linenums:322">renderView: (req, res, view, options) -&gt;
    logger.debug &quot;App.renderView&quot;, req.originalUrl, view, options

    try
        options = {} if not options?
        options.device = utils.browser.getDeviceString req
        options.title = settings.app.title if not options.title?

        # View filename must jave .pug extension.
        view += &quot;.pug&quot; if view.indexOf(&quot;.pug&quot;) &lt; 0

        # Send rendered view to client.
        res.render view, options

    catch ex
        logger.error &quot;App.renderView&quot;, view, ex
        @renderError req, res, ex

    events.emit &quot;App.on.renderView&quot;, req, res, view, options</pre></div></div></div></section><span class="fix-anchor" id="App__route"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__route_body"><h3 class="panel-title">App::route()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .route().</p>
</div></div><div class="panel-collapse collapse" id="App__route_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L285">/lib/app.coffee:285</a>)</span></div><pre class="sourcecode prettyprint .linenums:285">route: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.route.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__start"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__start_body"><h3 class="panel-title">App::start()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Start the server using HTTP or HTTPS, depending on the settings.</p>
</div></div><div class="panel-collapse collapse" id="App__start_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L172">/lib/app.coffee:172</a>)</span></div><pre class="sourcecode prettyprint .linenums:172">start: -&gt;
    if @webServer?
        return logger.warn &quot;App.start&quot;, &quot;Application has already started (webServer is not null). Abort!&quot;

    events.emit &quot;App.before.start&quot;

    if settings.app.ssl.enabled and settings.app.ssl.keyFile? and settings.app.ssl.certFile?
        sslKeyFile = utils.io.getFilePath settings.app.ssl.keyFile
        sslCertFile = utils.io.getFilePath settings.app.ssl.certFile

        # Certificate files were found? Proceed, otherwise alert the user and throw an error.
        if sslKeyFile? and sslCertFile?
            if fs.existsSync(sslKeyFile) and fs.existsSync(sslCertFile)
                sslKey = fs.readFileSync sslKeyFile, {encoding: settings.general.encoding}
                sslCert = fs.readFileSync sslCertFile, {encoding: settings.general.encoding}
                sslOptions = {key: sslKey, cert: sslCert}
                serverRef = https.createServer sslOptions, @expressApp
            else
                return errors.throw &quot;certificatesNotFound&quot;, &quot;Please check paths defined on settings.app.ssl.&quot;
        else
            return errors.throw &quot;certificatesNotFound&quot;, &quot;Please check paths defined on settings.app.ssl.&quot;
    else
        serverRef = http.createServer @expressApp

    # Expose the web server.
    @webServer = serverRef

    # Start the app!
    if settings.app.ip? and settings.app.ip isnt &quot;&quot;
        serverRef.listen settings.app.port, settings.app.ip
        logger.info &quot;App&quot;, settings.app.title, &quot;Listening on #{settings.app.ip} port #{settings.app.port}&quot;
    else
        serverRef.listen settings.app.port
        logger.info &quot;App&quot;, settings.app.title, &quot;Listening on port #{settings.app.port}&quot;

    # Using SSL and redirector port is set? Then create the http server.
    if settings.app.ssl.enabled and settings.app.ssl.redirectorPort &gt; 0
        logger.info &quot;App&quot;, &quot;#{settings.app.title} will redirect HTTP #{settings.app.ssl.redirectorPort} to HTTPS on #{settings.app.port}.&quot;

        redirServer = express()
        redirServer.get &quot;*&quot;, (req, res) -&gt; res.redirect &quot;https://#{req.hostname}:#{settings.app.port}#{req.url}&quot;

        # Log all redirector requests if debug is true.
        if settings.general.debug
            redirServer.use @requestLogger

        @redirectorServer = http.createServer redirServer
        @redirectorServer.listen settings.app.ssl.redirectorPort

    # Pass the HTTP(s) server created to external modules.
    events.emit &quot;App.on.start&quot;, serverRef</pre></div></div></div></section><span class="fix-anchor" id="App__use"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__use_body"><h3 class="panel-title">App::use()<span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Helper to call the Express App .use().</p>
</div></div><div class="panel-collapse collapse" id="App__use_body"><div class="panel-body"><div></div><h4>Parameters</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(None)</td></tr></table><h4>Returns</h4><table class="table table-bordered table-condensed table-hover"><tr><td>(Nothing)</td></tr></table><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L291">/lib/app.coffee:291</a>)</span></div><pre class="sourcecode prettyprint .linenums:291">use: =&gt;
    return errors.throw &quot;expressNotInit&quot; if not @expressApp?
    @expressApp.use.apply @expressApp, arguments</pre></div></div></div></section><span class="fix-anchor" id="App__appendMiddlewares"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__appendMiddlewares_body"><h3 class="panel-title">App::appendMiddlewares : <a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array'>Array</a><span class="label label-property">property</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Additional middlewares to be used by the Express server.
These will be called after the default middlewares.</p>
</div></div><div class="panel-collapse collapse" id="App__appendMiddlewares_body"><div class="panel-body"><div></div><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L55">/lib/app.coffee:55</a>)</span></div><pre class="sourcecode prettyprint .linenums:55">appendMiddlewares: []</pre></div></div></div></section><span class="fix-anchor" id="App__expressApp"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__expressApp_body"><h3 class="panel-title">App::expressApp : <a href='https://expressjs.com/en/4x/api.html#app'>express-Application</a><span class="label label-property">property</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Exposes the Express app object to the outside.</p>
</div></div><div class="panel-collapse collapse" id="App__expressApp_body"><div class="panel-body"><div></div><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L29">/lib/app.coffee:29</a>)</span></div><pre class="sourcecode prettyprint .linenums:29">expressApp: null</pre></div></div></div></section><span class="fix-anchor" id="App__prependMiddlewares"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__prependMiddlewares_body"><h3 class="panel-title">App::prependMiddlewares : <a href='https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array'>Array</a><span class="label label-property">property</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>Additional middlewares to be used by the Express server.
These will be called before the default middlewares.</p>
</div></div><div class="panel-collapse collapse" id="App__prependMiddlewares_body"><div class="panel-body"><div></div><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L48">/lib/app.coffee:48</a>)</span></div><pre class="sourcecode prettyprint .linenums:48">prependMiddlewares: []</pre></div></div></div></section><span class="fix-anchor" id="App__redirectorServer"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__redirectorServer_body"><h3 class="panel-title">App::redirectorServer : <a href='https://nodejs.org/api/http.html#http_class_http_server'>http-Server</a><span class="label label-property">property</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>The HTTP to HTTPS redirector server (only if settings.app.ssl.redirectorPort is set).</p>
</div></div><div class="panel-collapse collapse" id="App__redirectorServer_body"><div class="panel-body"><div></div><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L41">/lib/app.coffee:41</a>)</span></div><pre class="sourcecode prettyprint .linenums:41">redirectorServer: null</pre></div></div></div></section><span class="fix-anchor" id="App__webServer"></span><section><div class="panel panel-success"><div class="panel-heading collapsed" data-toggle="collapse" data-target="#App__webServer_body"><h3 class="panel-title">App::webServer : <a href='https://nodejs.org/api/http.html#http_class_http_server'>http-Server</a><span class="label label-property">property</span><span class="pull-right glyphicon"></span></h3><div class="method-summary"><p>The underlying HTTP(S) server.</p>
</div></div><div class="panel-collapse collapse" id="App__webServer_body"><div class="panel-body"><div></div><div class="showcode"><button class="btn btn-info">Show code</button><span> (defined in<a href="https://github.com/igoramadas/expresser/blob/master//lib/app.coffee#L35">/lib/app.coffee:35</a>)</span></div><pre class="sourcecode prettyprint .linenums:35">webServer: null</pre></div></div></div></section></div></div></div><script src="https://code.jquery.com/jquery-3.2.1.min.js"></script><script src="../bootstrap/js/bootstrap.min.js"></script><script src="../google-code-prettify/prettify.js"></script><script src="../script.js"></script><script src="../group-examples.js"></script><a href="https://github.com/igoramadas/expresser"><img class="github-ribbon" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a></body></html>